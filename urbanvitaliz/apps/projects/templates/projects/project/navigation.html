{% load static %}

{% load guardian_tags %}
{% get_obj_perms user for project as "permissions" %}

<!-- {{permissions}} -->

{% load sass_tags %}
{% block css %}
    <link href="{% sass_src 'home/css/dsfr/marianne.css' %}"
          rel="stylesheet"
          type="text/css">
    <link href="{% sass_src 'projects/css/project_navigation.css' %}"
          rel="stylesheet"
          type="text/css">
{% endblock %}

<ul class="project-navigation d-flex align-items-center"
    style="font-family: 'Marianne', arial, sans-serif;
           padding: 0">
    {% if "view_project" in permissions %}
    <li>
        <a class="{% if overview %} active{% endif %}"
           href="{% url 'projects-project-detail-overview' project.pk %}">
            Présentation
        </a>
    </li>
    {% endif %}
    <li class="position-relative survey">
        <a class="text-nowrap {% if state_of_play %} active{% endif %}"
           href="{% url 'projects-project-detail-knowledge' project.pk %}">
            <p>État des lieux</p>
            <div class="survey-completion">
                <div class="survey-completion-progress-bar-container">
                    <i class="survey-completion-progress-bar"
                       style="width: {{ active_project_survey_session.completion }}%;
                              {% if active_project_survey_session.completion >= 90 %}background-color:#5ec495{% else %}background-color:#f58188{% endif %}"></i>
                </div>
                <span class="survey-completion-number">{{ active_project_survey_session.completion }}%</span>
            </div>
        </a>
    </li>
    {% if "view_tasks" in permissions %}
    <li>
        <a class="{% if project.status == 'DRAFT' and not can_administrate %} disabled{% endif %} {% if recommandations %} active{% endif %} align-items-center"
           href="{% url 'projects-project-detail-actions' project.pk %}">
            {% if active_project_action_notifications_count %}
                <span class="has-notification">{{ active_project_action_notifications_count }}</span>
            {% endif %}
            {% if project.status == 'DRAFT' and not can_administrate %}
                <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                    <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                </svg>
                &nbsp;
            {% endif %}
            <span>Recommandations</span>
        </a>
    </li>
    {% endif %}
    {% if "view_public_notes" in permissions %}
        <li>
            <a class="{% if project.status == 'DRAFT' and not can_administrate %} disabled{% endif %} {% if conversation %} active{% endif %} align-items-center"
               href="{% url 'projects-project-detail-conversations' project.pk %}">
                {% if active_project_conversation_notifications_count %}
                    <span class="has-notification">{{ active_project_conversation_notifications_count }}</span>
                {% endif %}
                {% if project.status == 'DRAFT' and not can_administrate %}
                    <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                    </svg>
                {% endif %}
                <span class="">Conversation</span>
            </a>
        </li>
    {% endif %}
    {% if can_manage %}
        <li>
            <a class="{% if project.status == 'DRAFT' and not can_administrate %} disabled{% endif %} {% if files_links %} active{% endif %} align-items-center"
               href="{% url 'projects-project-detail-documents' project.pk %}">
                {% if active_project_document_notifications_count %}
                    <span class="has-notification">{{ active_project_document_notifications_count }}</span>
                {% endif %}
                {% if project.status == 'DRAFT' and not can_administrate %}
                    <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                    </svg>
                    &nbsp;
                {% endif %}
                <span class="">Fichiers et liens</span>
            </a>
        </li>
    {% endif %}
    {% if "view_private_notes" in permissions %}
        <li>
            <a class="{% if internal_followup %} active{% endif %} {% if not active_project_can_administrate %} disabled{% endif %}align-items-center"
               href="{% url 'projects-project-detail-internal-followup' project.pk %}">
                {% if active_project_private_conversation_notifications_count %}
                    <span class="has-notification">{{ active_project_private_conversation_notifications_count }}</span>
                {% endif %}
                {% if not active_project_can_administrate %}
                    <svg class="bi align-middle" width="18" height="18" fill="currentColor">
                        <use xlink:href="{% static 'svg/bootstrap-icons.svg'  %}#lock-fill" />
                    </svg>
                    &nbsp;
                {% endif %}
                <span class="text-nowrap">Espace conseillers</span>
            </a>
        </li>
    {% endif %}
    {% if "can_administrate_project" in permissions %}
        <li>
            <a class="{% if administration_panel %} active{% endif %} align-items-center"
               href="{% url 'projects-project-administration' project.pk %}">
                <span class="text-nowrap">Administration</span>
            </a>
        </li>
    {% endif %}
</ul>
